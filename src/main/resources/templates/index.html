<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ PingPong League - íƒêµ¬ ë¦¬ê·¸ í”Œë«í¼</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div class="container">
    <header>
        <h1><a href="/">PingPong League</a></h1>
        <nav>
            <a th:href="@{/checker}" class="btn btn-secondary">ğŸ” ë¶€ìˆ˜ ì²´í¬</a>

            <div sec:authorize="isAuthenticated()" class="user-info">
                ğŸ‘¤ <span th:text="${#authentication.principal.nickname}"></span> ë‹˜
                <a th:href="@{/logout}" class="btn btn-secondary">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
            <div sec:authorize="isAnonymous()">
                <a th:href="@{/login}" class="btn btn-secondary">ë¡œê·¸ì¸</a>
                <a th:href="@{/signup}" class="btn btn-primary">íšŒì›ê°€ì…</a>
            </div>
        </nav>
    </header>

    <main>
        <div class="section-header">
            <h2>ğŸ† ì§„í–‰ ì¤‘ì¸ ë¦¬ê·¸</h2>
            <a th:href="@{/league-rooms/new}" class="btn btn-primary">+ ìƒˆ ë¦¬ê·¸ ìƒì„±</a>
        </div>
        <div id="league-room-list" class="card-grid">
            <div style="text-align: center; padding: 3rem; color: var(--text-muted);">
                <p>â³ ë¦¬ê·¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
        </div>
    </main>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const listContainer = document.getElementById('league-room-list');

        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return 'ë¯¸ì •';
            const date = new Date(dateTimeString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}.${month}.${day} ${hours}:${minutes}`;
        }

        fetch('/api/league-rooms')
            .then(response => response.json())
            .then(data => {
                listContainer.innerHTML = '';
                if (data.length === 0) {
                    listContainer.innerHTML = '<p>ì•„ì§ ë¦¬ê·¸ ë°©ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>';
                } else {
                    data.forEach(room => {
                        const cardLink = document.createElement('a');
                        cardLink.href = `/league-rooms/${room.id}`;
                        cardLink.className = 'card';

                        // ìƒíƒœë³„ ì´ëª¨ì§€ ë° ìŠ¤íƒ€ì¼
                        const statusEmoji = {
                            'OPEN': 'ğŸŸ¢',
                            'IN_PROGRESS': 'ğŸ”µ',
                            'COMPLETED': 'âš«',
                            'CLOSED': 'ğŸ”´',
                            'FULL': 'ğŸŸ¡'
                        };
                        
                        const participantPercentage = (room.currentParticipants / room.maxParticipants) * 100;
                        const participantColor = participantPercentage >= 80 ? '#FF3D71' : participantPercentage >= 50 ? '#FFC107' : '#00E676';
                        const isFull = room.status.name === 'OPEN' && room.currentParticipants >= room.maxParticipants;
                        const statusLabel = isFull ? 'ëª¨ì§‘ì™„ë£Œ' : room.status.displayName;
                        const statusIcon = isFull ? statusEmoji.FULL : (statusEmoji[room.status.name] || 'âšª');

                        cardLink.innerHTML = `
                                <span class="location-badge">ğŸ“ ${room.location}</span>
                                <h3>${room.title}</h3>
                                <p style="margin-top: 1rem;"><strong>ğŸ—“ï¸ ${formatDateTime(room.eventDateTime)}</strong></p>
                                <p>ğŸ‘¤ ë°©ì¥: ${room.ownerUsername}</p>
                                <p>ğŸ“ ${room.gameType.displayName} Â· ${room.matchFormat.displayName}</p>
                                <p style="color: ${participantColor}; font-weight: 600;">
                                    ğŸ‘¥ ${room.currentParticipants} / ${room.maxParticipants}ëª…
                                </p>
                                <p style="color: var(--primary-color); font-weight: 600;">
                                    ${statusIcon} ${statusLabel}
                                </p>
                            `;
                        listContainer.appendChild(cardLink);
                    });
                }
            })
            .catch(error => {
                console.error('Error fetching league rooms:', error);
                listContainer.innerHTML = '<p>ë¦¬ê·¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
            });
    });
</script>
</body>
</html>
